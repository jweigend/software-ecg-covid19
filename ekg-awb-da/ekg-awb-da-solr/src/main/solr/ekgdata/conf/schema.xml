<?xml version="1.0" encoding="UTF-8" ?>


<schema name="Software-EKG" version="1.6">

    <types>
        <!-- The StrField type is not analyzed, but indexed/stored verbatim. -->
        <fieldType name="string" class="solr.StrField" sortMissingLast="true" omitNorms="true"  />

        <!-- boolean type: "true" or "false" -->
        <fieldType name="boolean" class="solr.BoolField" sortMissingLast="true" omitNorms="true"/>

        <!-- Unique ID type -->
        <fieldType name="uuid" class="solr.UUIDField" indexed="true" stored="true" />

        <!-- Date -->
        <fieldType name="tdate" class="solr.TrieDateField" omitNorms="true" precisionStep="6" positionIncrementGap="0"/>

        <fieldType name="int" class="solr.TrieIntField" precisionStep="0" positionIncrementGap="0"/>
        <fieldType name="float" class="solr.TrieFloatField" precisionStep="0" positionIncrementGap="0"/>
        <fieldType name="long" class="solr.TrieLongField" precisionStep="0" positionIncrementGap="0"/>
        <fieldType name="double" class="solr.TrieDoubleField" precisionStep="0" positionIncrementGap="0"/>

        <fieldType name="text" class="solr.TextField">
            <analyzer>
                <tokenizer class="solr.WhitespaceTokenizerFactory"/>
            </analyzer>
        </fieldType>

        <fieldType name="binary" class="solr.BinaryField"/>

    </types>

    <fields>
        <field name="_version_" type="long" indexed="true" stored="true"/>

        <!-- common -->
        <field name="id"   type="uuid"   indexed="true" stored="true" required="true"/>
        <field name="type" type="string" indexed="true" stored="true" required="true"/>

        <!--
        ******************************************************************************************************
          project data fields
        ******************************************************************************************************
        -->

        <!-- The name of the project (should be unique) -->
        <field name="project_name" type="string" indexed="true" stored="true" required="false"/>

        <!-- A description text that provides more details to the project -->
        <field name="project_description" type="string" indexed="true" stored="true" required="false"/>

        <!-- true = SPLIT_SOURCE_PROJECT, false = LOCAL_PROJECT (see ProjectType enum) -->
        <field name="project_useSplitSource" type="boolean" indexed="true" stored="true" required="false"/>

        <!-- CLASSIC; HYBRID; CLOUD_NATIVE (see ProjectFlavor enum) -->
        <field name="project_flavor" type="string" indexed="true" stored="true" required="false"/>

        <!-- DEFAULT; GENERIC; SPECIALIZED (see ProjectTimeSeriesType enum) -->
        <field name="project_timeseries_type" type="string" indexed="true" stored="true" required="false"/>

        <!-- NONE; OPEN_SHIFT; KUBERNETES; OTHER (see CloudPlatformType enum) -->
        <field name="project_cn_type" type="string" indexed="true" stored="true" required="false"/>

        <!-- The id of the importer the that is allowed to import data to this project -->
        <field name="project_importerId" type="string" indexed="true" stored="true" required="false"/>

        <!-- project specific dimension alias (optional filled) -->
        <field name="project_dimension_alias_hostGroup"   type="string" indexed="false" stored="true" required="false"/>
        <field name="project_dimension_alias_host"        type="string" indexed="false" stored="true" required="false"/>
        <field name="project_dimension_alias_namespace"   type="string" indexed="false" stored="true" required="false"/>
        <field name="project_dimension_alias_service"     type="string" indexed="false" stored="true" required="false"/>
        <field name="project_dimension_alias_pod"         type="string" indexed="false" stored="true" required="false"/>
        <field name="project_dimension_alias_container"   type="string" indexed="false" stored="true" required="false"/>
        <field name="project_dimension_alias_measurement" type="string" indexed="false" stored="true" required="false"/>
        <field name="project_dimension_alias_process"     type="string" indexed="false" stored="true" required="false"/>
        <field name="project_dimension_alias_metricGroup" type="string" indexed="false" stored="true" required="false"/>
        <field name="project_dimension_alias_metricName"  type="string" indexed="false" stored="true" required="false"/>

        <!-- dynamic filter dimensions for project data -->
        <dynamicField name="project_ext_*" type="string" indexed="true" stored="true" required="false"/>


        <!--
        ******************************************************************************************************
          types config used either for EKG repositories and also for importers remote data sources
        ******************************************************************************************************
        -->
        <!--
           an optional id of remote data source that that is bind to the project by the importer
           (for example an Prometheus instance)
         -->

        <!-- Persisted field with a flag if the types is an import source -->
        <field name="repository_isSource"         type="boolean" indexed="true"  stored="true" required="false"/>

        <!-- Persisted field with the name of the types -->
        <field name="repository_name"             type="string"  indexed="true"  stored="true" required="false"/>

        <!-- Persisted field with the types type (remote Solr classic, remote Solr cloud, remote ElasticSearch, local Solr) -->
        <field name="repository_dbType"           type="string"  indexed="true"  stored="true" required="false"/>

        <!-- Persisted field with the types url used to fetch the data -->
        <field name="repository_url"              type="string"  indexed="false" stored="true" required="false"/>

        <!-- Persisted field with the types url used to fetch the data -->
        <field name="repository_dbIndexName"      type="string"  indexed="false" stored="true" required="false"/>

        <!-- Persisted field that stores the authentication type of the types (NONE, API_KEY, USER_PASSWORD) -->
        <field name="repository_authType"         type="string"  indexed="false" stored="true" required="false"/>

        <!-- Persisted field that stores the user name if credentials are required -->
        <field name="repository_user"             type="string"  indexed="false" stored="true" required="false"/>

        <!-- Field that stores the user password or API key (depending of auth type that is in use) -->
        <field name="repository_pass"             type="string"  indexed="false" stored="true" required="false"/>

        <!-- Field to store the absolute URL of the OAuth server that issued the access and refresh tokens. -->
        <field name="repository_oauthServerUrl"   type="string"  indexed="true"  stored="true" required="false"/>

        <!-- Field to store temporary valid SSO Tokens insert manually or fetched using username/password -->
        <field name="repository_ssoToken"         type="string"  indexed="true"  stored="true" required="false"/>

        <!-- Field with the name of the project this types belongs to -->
        <field name="repository_accordingProject" type="string"  indexed="true"  stored="true" required="false"/>

        <!-- dynamic filter dimensions for project data -->
        <dynamicField name="repository_ext_*" type="string" indexed="true" stored="true" required="false"/>
        <!--
        ******************************************************************************************************
          time series data fields
        ******************************************************************************************************
        -->

        <!-- classic only filter dimensions-->
        <field name="ts_hostGroup"   type="string" indexed="true" stored="true" required="false" docValues="true" />
        <field name="ts_host"        type="string" indexed="true" stored="true" required="false" docValues="true" />

        <!-- cloud native only filter dimensions -->
        <field name="ts_namespace"   type="string" indexed="true" stored="true" required="false" docValues="true" />
        <field name="ts_service"     type="string" indexed="true" stored="true" required="false" docValues="true" />
        <field name="ts_pod"         type="string" indexed="true" stored="true" required="false" docValues="true" />
        <field name="ts_container"   type="string" indexed="true" stored="true" required="false" docValues="true" />

        <!-- common dimensions filter dimensions -->
        <field name="ts_measurement" type="string" indexed="true" stored="true" required="false" docValues="true" />
        <field name="ts_process"     type="string" indexed="true" stored="true" required="false" docValues="true" />
        <field name="ts_metricGroup" type="string" indexed="true" stored="true" required="false" docValues="true" />
        <field name="ts_metricName"  type="string" indexed="true" stored="true" required="false" docValues="true" />

        <!-- ===== metadata of the time-series ==== -->

        <!--
          The series key that can be a simple string or complex serialized object (for e.g. JSON) that will used
          to identify the series data in databases of other applications than the Split-Source feature is in use.
          This is necessary because Software-EKG and other software systems doesn't use similar attributes to
          identify records in the database or make than unique.
         -->
        <field name="ts_remoteSeriesKey"   type="string"  indexed="false" stored="true" required="false" />

        <!--
          The data-time of the time series was imported/written to
          the EKG repository (with precession on milliseconds).
        -->
        <field name="ts_importDate"        type="tdate"   indexed="true"  stored="true" required="false" />

        <!--
          The time series data itself as byte array. Each measured value is stored as tuple of
          timestamp (long, 8 byte) and the value (double, 8 byte). So each tuple has 16 byte in
          total and the array has an multiple of 16 as length.
        -->
        <field name="ts_data"              type="binary"  indexed="false" stored="true" required="false" />

        <!--
          Integer value that stores the amount of tuples (timestamp/value) in the time series.
          This value = the amount of points/values in the time series.
         -->
        <field name="ts_data_amountValues" type="int"     indexed="false" stored="true" required="false" docValues="true" />

        <!--
         The data-time of the first value of the time series.
         This is the exact moment than the series starts (with precession on milliseconds).
        -->
        <field name="ts_start"             type="tdate"   indexed="true"  stored="true" required="false" />

        <!--
         The data-time of the last value of the time series.
         This is the exact moment than the series ends (with precession on milliseconds).
        -->
        <field name="ts_end"               type="tdate"   indexed="true"  stored="true" required="false" />

        <!--
         Field that stores an aggregated view on the values in the time series. This can
         used than the aggression is often used and expensive in calculation.
         -->
        <field name="ts_ag"                type="string"  indexed="true"  stored="true" required="false" />

        <!--
         A control flag used by the EKG Collector mark which document are already merged
         in a batch job that collect many documents and merge it to a single one.
        -->
        <field name="ts_isMerged"          type="boolean" indexed="true"  stored="true" required="false" />

        <!--
         A hash value over all filter dimensions that can use to identify series records
         that belongs together by comparing/grouping only one attribute instead of multiple ones.
         (primary used by EKG Collector)
        -->
        <field name="ts_groupKeyHash"      type="int"     indexed="true"  stored="true" required="false" />

        <!-- dynamic filter dimensions -->
        <dynamicField name="ts_ext_dimension_*" type="string" indexed="true" stored="true" required="false"/>

        <!--
        ******************************************************************************************************
          bookmarks
        ******************************************************************************************************
        -->

        <!-- The name of the bookmark that will displayed in the UI -->
        <field name="bookmarkName"  type="string" indexed="true"  stored="true" required="false"/>

        <!-- The unique id of the bookmark group. The id for the global space will be '_BOOKMARK_GLOBAL_' -->
        <field name="bookmarkGroupId"   type="string" indexed="true"  stored="true" required="false"/>

        <!-- The name of the bookmark group the bookmark belongs to. If not defined 'GLOBAL' will used as default. -->
        <field name="bookmarkGroupName"   type="string" indexed="true"  stored="true" required="false"/>

        <!-- The description of the bookmark that provides further informations about the bookmark -->
        <field name="bookmarkDescription" type="string" indexed="false" stored="true" required="false"/>

        <!-- The JSON serialized protocol of each chart action that were handled by the ProtocolManager -->
        <field name="bookmarkProtocol"    type="string" indexed="false" stored="true" required="false"/>

        <!-- The timezone setting the user currently uses -->
        <field name="bookmarkTimeZone"    type="string" indexed="false" stored="true" required="false"/>

        <!-- dynamic filter dimensions for bookmark data -->
        <dynamicField name="bookmark_ext_*" type="text" indexed="true" stored="true" required="false"/>

    </fields>

    <!--
    PersistedField to use to determine and enforce document uniqueness. Unless this field is marked
    with required="false", it will be a required field
    -->
    <uniqueKey>id</uniqueKey>

</schema>
